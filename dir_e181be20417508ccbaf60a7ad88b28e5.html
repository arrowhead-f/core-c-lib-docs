<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Doxygen 1.9.5"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ah_base Directory Reference - Eclipse Arrowhead™ Core C Libraries</title>
  <script src="jquery.js"></script>
  <script src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
  <script>
    window.addEventListener("load", () => {
      let contents = document.querySelector("body > div.contents");
      if (!contents) {
        return;
      }
      document.querySelectorAll("#top ul > li.current > a > span").forEach((selectedMenuItem) => {
        contents.classList.add(selectedMenuItem.innerText.trim().toLowerCase().replace(/\s+/, "-"));
      });
      for (let i = contents.childNodes.length - 1; i >= 0; i -= 1) {
        let childNode = contents.childNodes.item(i);
        if ((childNode.nodeType === 3 && childNode.textContent.trim().length === 0)
                || (childNode.nodeType === 1 && childNode.classList.contains("textblock") && childNode.textContent.trim().length === 0)) {
          childNode.remove();
        }
      }
    });
  </script>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <link href="DoxygenStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top">
  <header>
    <img alt="Logo" src="arrowhead-logo-white.svg"/>
    <h1>Eclipse Arrowhead™ Core C Libraries <span class="version"></span></h1>
  </header>
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li class="current"><a href="files.html"><span>Headers</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_e181be20417508ccbaf60a7ad88b28e5.html">ah_base</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">ah_base Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Base library. </p>
<p >This library provides the foundation upon which most other Core C libraries depend. It most significantly exposes a cross-platform API over some I/O utilities provided by the targeted platforms, such as TCP/IP networking. Most of the I/O operations exposed by this library are provided as asynchronous functions, which is to say that their results are provided after they return by invoking given callback functions. All asynchronous functionality of the library is managed via so-called event loops (see <a class="el" href="loop_8h.html" title="Event scheduling.">include/ah/loop.h</a>), which can be seen as single-threaded event queues managed by this library.</p>
<p >As managing events require several kinds of peripheral functionality, some of that is also exposed, or made configurable (see <a class="el" href="conf_8h.html" title="Library configuration.">include/ah/conf.h</a>), by this library. Buffers, error codes, safe math functions and time querying are some notable examples.</p>
<p >Another primary purpose of this library is to gather together key functionality that must be ported in order for this and most other official Arrowhead Core C libraries to support another platform. While there may be some exceptions, this library being ported to a certain platform should mean that most officials libraries can run on that platform.</p>
<p >Asynchronous I/O was popularized primarily via libuv, which is the C library on top of which the now ubiquitous Node.js JavaScript runtime is built. That library, as well as the alternatives we know of, such as libevent and libev, were designed primarily to support creating server applications for the World Wide Web. As such, they make rather strong assumptions about the facilities of the operating systems required to run them (such as the availability of filesystems and inter-process signaling), as well as the hardware capabilities of those servers. In contrast, this base library, and most of its official companion libraries, are designed primarily to support creating machine-centric applications, or system-of-systems. Many of those machines may have limited software and hardware capabilities, such as not being able to run full operating systems or not having access to significant compute or memory facilities. While a WWW server will typically have at least hundreds of megabytes of RAM and disk storage, an Arrowhead system running this library may have hundreds of kilobytes of RAM and ROM.</p>
<h3><a class="anchor" id="autotoc_md0"></a>
Dependencies</h3>
<p >Every supported platform may depend on particular libraries distributed by the creator of the platform. However, as these libraries tend to be distributed with the compiler for the platform, you will typically not need to do anything beyond making sure the compiler and/or appropriate SDKs to be installed and available.</p>
<p >An exception to this is, however, the use of <a href="https://unixism.net/loti/what_is_io_uring.html">io_uring</a> on the Linux platform, which requires the <code>liburing</code> library. If you want to compile this library for Linux, <code>liburing-2.2</code> or later is required. If you have a working Internet connection, CMake will attempt to download and compile the library automatically. If, however, any version of <code>liburing</code> is already installed and available on your system, that version will be used without any download being initiated.</p>
<h3><a class="anchor" id="autotoc_md1"></a>
Porting</h3>
<p >If the current set of platforms supported by this library is insufficient, you may want to extend that set by porting it to another one. To do so, you will need to do the following:</p>
<ol type="1">
<li><b>Update the <code>CMakeLists.txt</code> file in the root folder of this library.</b> In particular, you must make sure that any source files and platform libraries your port depends on are included when it is built. As the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SYSTEM_NAME.html"><code>CMAKE_SYSTEM_NAME</code></a> is used to determine what platform is being targeted, you should conditionally add whatever files and libraries are needed when it has a suitable value. If your port further depends on certain hardware platforms being targeted, a certain compiler being available, etc. them you may have to use <a href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html">other variables provide by CMake</a>.</li>
<li><b>Determine what source files you need to write and create them.</b> There are platform-specific source files in two locations: (A) in the <code>/libraries/ah_base/include/ah/internal/</code> folder and (B) the <code>/libraries/ab_base/src/</code> folder. The former folder contains header files that include and/or define whatever is needed for the various structures of this library to contain the correct fields and have sizes known at compile-time. The second folder contains the source files implementing the functions of this library. Every platform-specific source file has a name ending with a dash and a special name that identifies the platform it targets or a special library available on multiple platforms. You can, for example, find files ending with <code>-win32.h</code>, <code>-posix.h</code>, <code>-kqueue.h</code>, <code>-uring.c</code> and <code>-darwin.c</code>. Decide what file ending or endings are most appropriate for the platform you target, and make sure that all files exist you will need write. If your platform supports a library or standard already supported by another platform, such as KQueue or POSIX, you may want to use those files rather than write new ones.</li>
<li><b>Add all source files you created, and existing platform-specific ones</b> <b>you wish to use, to your platform's source file list in the CMake</b> <b>project file</b>. That source list, which must include both header files and source files, must be appended to the <code>SOURCE_FILES</code> variable of the <code>/libraries/ah_base/CMakeLists.txt</code> file.</li>
<li><b>Make the library compile for your platform.</b> When you first try to compile for your platform, the compiler is likely going to fail because your source files are not containing any compilation units. If you are using either of the Clang or GCC compilers, you can suppress this by removing the <code>-Werror</code> flag from the <code>add_compile_options()</code> command in the <code>/CMakeLists.txt</code> file at the root of the Core C repository. Now, you must add every function the compiler or linker is missing in order to complete the build. Those functions will generally have names starting with <code>ah_</code>. If you need help regarding what files to place the functions in, refer to the source files of the already supported platforms. You may leave the function bodies empty, for the time being. When compiling and linking finishes without errors, try to compile and run the <code>ah_base_tests</code> project. It should run, but notify you about various assertions that are failing.</li>
<li><b>Add a suitable platform macro to <code>/libraries/ah_base/include/ah/defs.h</code>.</b> You are likely going to need a macro named <code>AH_IS_&lt;YOUR-PLATFORMS-NAME&gt;</code> when you later make sure your platform-specific header files are included properly. Add the macro and make sure it is set to <code>1</code> or <code>0</code> depending on if your platform is being targeted. If your target is POSIX-compliant, uses a library already used by some other platform, and so on, you may also wish to modify other macros to reflect these facts.</li>
<li><b>Make sure your platform-specific internal header files are included only</b> <b>when compiling for your platform.</b> If you, for example, have created a header file named <code>/libraries/ah_base/include/ah/internal/_time-android.h</code>, you must modify <code>/libraries/ah_base/include/ah/internal_time.h</code> such that it includes the created file when the targeted platform is <code>Android</code>. The same kind of treatment must be given to every relevant internal header file.</li>
<li><b>Add correctly named include guards to your internal header files.</b> The name of each include guard is derived from the path of the file relative to the <code>/libraries/ah_base/include/</code> directory. That relative path has every path separator, dash and dot replaced by an underscore. A trailing underscore is also added. Any double underscores are replaced by a single underscore. If, for example, the header file in question is the same <code>_time-android.h</code> file we mentioned in the last step, the include guard must be named <code>AH_INTERNAL_TIME_ANDROID_H_</code>.</li>
<li><b>Implement all platform-specific functions and make CMake download and/or</b> <b>find any required libraries.</b> A strong indicator that you are approaching the completion of this step is that you can execute <code>ah_base_tests</code> without any failed assertions. You may want to add more tests to this application to cover potential issues it currently cannot identify. Please refer to the existing implementations for guidance regarding how to validate function arguments, internal state, and so on.</li>
<li><b>Update the documentation.</b> Now that another platform is supported, the documentation must be updated to reflect this support. In particular, the following files must be updated:<ul>
<li><code>/libraries/README.md</code> The section on supported platforms and compilers must include the new platform.</li>
<li><code>/libraries/ah_base/README.md</code> If your platform requires certain libraries or build tools, it must be documented in this file.</li>
<li><code>/libraries/ah_base/include/ah/defs.h</code> Any macros you added or updated may need to be documented.</li>
<li><em>Every function or callback that may return or provide an error code from</em> <em>your platform implementation.</em> For example, <a class="el" href="task_8h.html#a9853b089cf66d6c38c3fd3c274ff9433" title="Schedules task for execution at or after baseline.">ah_task_schedule_at()</a> and <a class="el" href="structah__tcp__conn__cbs.html#a0a44ae428dd85ea371dd784c6bf3d761" title="conn has been opened, or the attempt failed.">ah_tcp_conn_cbs::on_open</a> both rely on platform-specific implementations that could produce error codes unique to each respective platform. Every place where error codes specific to your platform could be presented must be updated.</li>
</ul>
</li>
<li><b>If relevant, present your port to the Eclipse Arrowhead leads and</b> <b>committers.</b> If your port becomes an official part of the Eclipse Arrowhead project, you may get help in maintaining your port over time. More information about contributing to Eclipse Arrowhead can be read on the Overview page if you are reading the Doxygen documentation. If you are reading on GitHub or directly in the source code, that information is available in <code>/libraries/README.md</code>. </li>
</ol>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">directory &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_4e09807cd623eda32c4b1ef4b2b976fd.html">include</a></td></tr>
<tr class="memdesc:dir_4e09807cd623eda32c4b1ef4b2b976fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base library include folder. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
  <footer>Generated by <a href="https://doxygen.org">Doxygen</a> 1.9.5</footer>
</body>
</html>
